(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))l(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&l(n)}).observe(document,{childList:!0,subtree:!0});function i(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(e){if(e.ep)return;e.ep=!0;const s=i(e);fetch(e.href,s)}})();const h={flower:{displayName:"Flower of Life"},plume:{displayName:"Plume of Death"},sands:{displayName:"Sands of Eon"},goblet:{displayName:"Goblet of Eonothem"},circlet:{displayName:"Circlet of Logos"}},g={flower:{HP:1},plume:{ATK:1},sands:{"HP%":8,"ATK%":8,"DEF%":8,EM:3,ER:3},goblet:{"HP%":77,"ATK%":77,"DEF%":76,"PYRO%":20,"ELECTRO%":20,"CRYO%":20,"HYDRO%":20,"DENDRO%":20,"ANEMO%":20,"GEO%":20,"PHYSICAL%":20,EM:10},circlet:{"HP%":11,"ATK%":11,"DEF%":11,CR:5,CD:5,HB:5,EM:2}},A={HP:6,ATK:6,DEF:6,"HP%":4,"ATK%":4,"DEF%":4,EM:4,ER:4,CR:3,CD:3},p={HP:[209.13,239,268.88,298.75],ATK:[13.62,15.56,17.51,19.45],DEF:[16.2,18.52,20.83,23.15],"HP%":[4.08,4.66,5.25,5.83],"ATK%":[4.08,4.66,5.25,5.83],"DEF%":[5.1,5.83,6.56,7.29],EM:[16.32,18.65,20.98,23.31],ER:[4.53,5.18,5.83,6.48],CR:[2.72,3.11,3.5,3.89],CD:[5.44,6.22,6.99,7.77]},v={HP:{displayName:"HP",hasPercentage:!1,decimalPlaces:0},ATK:{displayName:"ATK",hasPercentage:!1,decimalPlaces:0},DEF:{displayName:"DEF",hasPercentage:!1,decimalPlaces:0},"HP%":{displayName:"HP",hasPercentage:!0,decimalPlaces:1},"ATK%":{displayName:"ATK",hasPercentage:!0,decimalPlaces:1},"DEF%":{displayName:"DEF",hasPercentage:!0,decimalPlaces:1},EM:{displayName:"Elemental Mastery",hasPercentage:!1,decimalPlaces:0},ER:{displayName:"Energy Recharge",hasPercentage:!0,decimalPlaces:1},CR:{displayName:"CRIT Rate",hasPercentage:!0,decimalPlaces:1},CD:{displayName:"CRIT DMG",hasPercentage:!0,decimalPlaces:1}},T={HP:{displayName:"HP"},ATK:{displayName:"ATK"},DEF:{displayName:"DEF"},"HP%":{displayName:"HP"},"ATK%":{displayName:"ATK"},"DEF%":{displayName:"DEF"},EM:{displayName:"Elemental Mastery"},ER:{displayName:"Energy Recharge"},CR:{displayName:"CRIT Rate"},CD:{displayName:"CRIT DMG"},HB:{displayName:"Healing Bonus"},"PYRO%":{displayName:"Pyro DMG Bonus"},"ELECTRO%":{displayName:"Electro DMG Bonus"},"CRYO%":{displayName:"Cryo DMG Bonus"},"HYDRO%":{displayName:"Hydro DMG Bonus"},"DENDRO%":{displayName:"Dendro DMG Bonus"},"ANEMO%":{displayName:"Anemo DMG Bonus"},"GEO%":{displayName:"Geo DMG Bonus"},"PHYSICAL%":{displayName:"Physical DMG Bonus"}},M={domain:1/5,other:1/3};class E{setKey;slotKey;level;mainStatKey;substats;source;constructor(t,i=null,l=0,e=null,s=[],n="domain"){this.setKey=t,this.slotKey=i??this.initializeSlot(),this.level=l,this.mainStatKey=e??this.initializeMainStat(),this.substats=s.length?s:this.initializeSubstats(n),this.source=n}initializeSlot(){const t=Object.keys(h);return t[Math.floor(Math.random()*t.length)]}initializeMainStat(){const t=g[this.slotKey],i=Object.entries(t),l=i.reduce((n,[,c])=>n+c,0),e=Math.random()*l;let s=0;for(const[n,c]of i)if(s+=c,e<=s)return n;return i[0][0]}initializeSubstats(t){const i=[],l={...A};delete l[this.mainStatKey];for(let e=0;e<4;e++){const s=Object.values(l).reduce((u,d)=>u+d,0),n=Math.random()*s;let c=0;for(const[u,d]of Object.entries(l))if(c+=d,n<=c){const y=Math.floor(Math.random()*4);i.push({statKey:u,rolls:[{tier:y,value:p[u][y]}],isActive:e<3||Math.random()<M[t]}),delete l[u];break}}return i}levelUp(t=1){const i=Math.min(this.level+t,20);for(let l=this.level+1;l<=i;l++)if(l%4===0)if(!this.substats[3].isActive)this.substats[3].isActive=!0;else{const e=this.substats[Math.floor(Math.random()*4)],s=Math.floor(Math.random()*4);e.rolls.push({tier:s,value:p[e.statKey][s]})}this.level=i}getDisplayData(t){const i=t[this.setKey];return{artifactName:i.slotNames[this.slotKey],slotName:h[this.slotKey].displayName,mainStatKey:this.mainStatKey,level:this.level,setName:i.displayName,substats:this.substats}}}async function S(){const a=await fetch("./data/artifact_sets.json");if(!a.ok)throw new Error(`Failed to load artifact sets: ${a.statusText}`);return await a.json()}function K(a,t){return+(Math.round(+(a+"e+"+t))+"e-"+t)}function o(a){const t=document.getElementById(a);if(!t)throw new Error(`Element with ID "${a}" not found`);return t}let m=null,r=null;const N=o("set-selector"),C=o("generate-btn");b();async function b(){m=await S(),R(),P(!1),w()}function R(){m&&(Object.entries(m).forEach(([a,t])=>{N.add(new Option(t.displayName,a))}),C.addEventListener("click",O))}function O(){if(!m)return;const a=N.value;a&&(r=H(a),f(r),P(!0))}function H(a){if(!o("double-crit-only").checked)return new E(a);for(;;){const i=new E(a),l=i.substats.some(s=>s.statKey==="CR"),e=i.substats.some(s=>s.statKey==="CD");if(l&&e)return i}}function f(a){if(!m)return;const t=a.getDisplayData(m);o("artifact-name").textContent=t.artifactName,o("slot-name").textContent=t.slotName,o("main-stat-name").textContent=T[t.mainStatKey].displayName,o("level").textContent=`+${t.level}`,o("set-name").textContent=t.setName,a.substats.forEach((i,l)=>{const e=o(`substat-${l+1}`),s=i.rolls.reduce((y,D)=>y+D.value,0),n=v[i.statKey],c=K(s,n.decimalPlaces).toFixed(n.decimalPlaces),u=n.hasPercentage?"%":"";let d=`${n.displayName}+${c}${u}`;i.isActive?e.style.color="":(d+="  (unactivated)",e.style.color="gray"),e.textContent=`Â·${d}`}),o("artifact-img").src=`data/icons/${a.setKey}/${a.slotKey}.webp`}function P(a){o("level-up-1").disabled=!a,o("level-up-tier").disabled=!a,o("level-up-max").disabled=!a}function w(){o("level-up-1").addEventListener("click",()=>{r&&(r.levelUp(1),f(r))}),o("level-up-tier").addEventListener("click",()=>{if(!r)return;const a=Math.min(Math.ceil((r.level+1)/4)*4,20);r.levelUp(a-r.level),f(r)}),o("level-up-max").addEventListener("click",()=>{r&&(r.levelUp(20-r.level),f(r))})}
